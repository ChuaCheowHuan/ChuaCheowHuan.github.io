---
layout: posts
author: Huan
title: DQN
---
A **Deep Q Network** implementation in tensorflow with target network & random experience replay.

Environment from OpenAI's gym: CartPole-v0

[Full code](https://github.com/ChuaCheowHuan/reinforcement_learning/tree/master/DQN_variants/DQN)

---
<br>

**Notations:**

Model network = $$Q_{\theta}$$ \\
Model parameter = $$\theta$$ \\
Model network Q value = $$Q_{\theta}$$ (s, a) \\
<br>
Target network = $$Q_{\phi}$$ \\
Target parameter = $$\phi$$ \\
Target network Q value = $$Q_{\phi}$$ ($$s^{'}$$, $$a^{'}$$)

---
<br>

**Equations:**

TD target = r (s, a) $$+$$ $$\gamma$$ $$max_{a}$$ $$Q_{\phi}$$ ($$s^{'}$$, $$a^{'}$$) \\
<br>
TD  error = (TD target) $$-$$ (Model network Q value) \\
$$\hspace{26pt}$$
= [r (s, a) $$+$$ $$\gamma$$ $$max_{a^{'}}$$ $$Q_{\phi}$$ ($$s^{'}$$, $$a^{'}$$)] $$-$$ $$Q_{\theta}$$ (s, a)

---
<br>

**Implementation details:**

Update target parameter $$\phi$$ with model parameter $$\theta$$ :
<br>
Copy $$\theta$$ to $$\phi$$ with *either* soft or hard parameter update.
<br>

Hard parameter update:
```
with tf.variable_scope('hard_replace'):
  self.target_replace_hard = [t.assign(m) for t, m in zip(self.target_net_params, self.model_net_params)]   
```
```
# hard params replacement
if self.learn_step % self.tau_step == 0:
    self.sess.run(self.target_replace_hard)  
self.learn_step += 1
```
<br>

Soft parameter update:
<br>
polyak $$\cdot$$  $$\theta$$ + (1 $$-$$ polyak)  $$\cdot$$  $$\phi$$

```
with tf.variable_scope('soft_replace'):            
  self.target_replace_soft = [t.assign(self.polyak * m + (1 - self.polyak) * t)
                              for t, m in zip(self.target_net_params, self.model_net_params)]   
```

<br>
Stop TD target from contributing to gradient computation:
```
# exclude td_target in gradient computation
td_target = tf.stop_gradient(td_target)
```
---
<br>

**References:**

[Human-level control through deep reinforcement learning
(Mnih et al., 2015)](https://storage.googleapis.com/deepmind-media/dqn/DQNNaturePaper.pdf)
<br>
